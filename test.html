<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas del Sistema - Examen M√©dico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            margin-bottom: 30px;
        }
        h2 {
            color: #475569;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        .test-group {
            margin-bottom: 30px;
        }
        .test-item {
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
            background: #f0f9ff;
            border-radius: 5px;
        }
        .test-item.pass {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .test-item.fail {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-status {
            font-weight: 600;
            margin-right: 10px;
        }
        .pass .test-status::before { content: "‚úì "; color: #10b981; }
        .fail .test-status::before { content: "‚úó "; color: #ef4444; }
        .waiting .test-status::before { content: "‚è≥ "; color: #f59e0b; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-top: 20px;
        }
        button:hover {
            background: #1e40af;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .result-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            color: white;
        }
        .result-card.success {
            background: #10b981;
        }
        .result-card.warning {
            background: #f59e0b;
        }
        .result-card.danger {
            background: #ef4444;
        }
        .result-value {
            font-size: 28px;
            font-weight: 700;
        }
        .result-label {
            font-size: 14px;
            opacity: 0.9;
        }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Panel de Pruebas del Sistema</h1>
        
        <div class="test-group">
            <h2>Verificaci√≥n de Archivos</h2>
            <div id="filesTests"></div>
        </div>

        <div class="test-group">
            <h2>Verificaci√≥n de Funciones</h2>
            <div id="functionsTests"></div>
        </div>

        <div class="test-group">
            <h2>Carga de Datos</h2>
            <div id="dataTests"></div>
        </div>

        <div class="results" id="results" style="display:none;">
            <div class="result-card success">
                <div class="result-value" id="passCount">0</div>
                <div class="result-label">Pruebas Exitosas</div>
            </div>
            <div class="result-card warning">
                <div class="result-value" id="waitCount">0</div>
                <div class="result-label">En Progreso</div>
            </div>
            <div class="result-card danger">
                <div class="result-value" id="failCount">0</div>
                <div class="result-label">Fallos</div>
            </div>
        </div>

        <div>
            <button onclick="runAllTests()">üîÑ Ejecutar todas las pruebas</button>
            <button onclick="location.href='index.html'" style="background: #64748b;">‚Üê Volver a la App</button>
        </div>
    </div>

    <script>
        const especialidades = [
            "Anestesiolog√≠a", "Cardiolog√≠a", "Dermatolog√≠a", 
            "Diagn√≥stico por Im√°genes", "Hematolog√≠a", "Neumonolog√≠a",
            "Neurolog√≠a", "Ortopedia", "Otorrinolaringolog√≠a",
            "Pediatr√≠a", "Psiquiatr√≠a", "Tocoginecolog√≠a", "Urolog√≠a"
        ];

        function addTest(groupId, testName, status = "waiting") {
            const test = document.createElement("div");
            test.className = `test-item ${status}`;
            test.innerHTML = `<span class="test-status"></span>${testName}`;
            document.getElementById(groupId).appendChild(test);
            return test;
        }

        function updateTest(testElement, status, message = "") {
            testElement.className = `test-item ${status}`;
            testElement.innerHTML = `<span class="test-status"></span>${testElement.textContent.slice(1)}${message ? `: ${message}` : ""}`;
        }

        function updateResults() {
            const tests = document.querySelectorAll(".test-item");
            let passed = 0, failed = 0, waiting = 0;
            
            tests.forEach(t => {
                if (t.classList.contains("pass")) passed++;
                if (t.classList.contains("fail")) failed++;
                if (t.classList.contains("waiting")) waiting++;
            });
            
            document.getElementById("passCount").textContent = passed;
            document.getElementById("failCount").textContent = failed;
            document.getElementById("waitCount").textContent = waiting;
            document.getElementById("results").style.display = "grid";
        }

        async function testFiles() {
            const files = ["index.html", "app.js", "style.css"];
            
            for (const file of files) {
                const test = addTest("filesTests", `Archivo ${file}`);
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        updateTest(test, "pass", `(${response.headers.get('content-length')} bytes)`);
                    } else {
                        updateTest(test, "fail", `Error: ${response.status}`);
                    }
                } catch (e) {
                    updateTest(test, "fail", e.message);
                }
            }
        }

        async function testFunctions() {
            // Test formatearTiempo
            let test = addTest("functionsTests", "Funci√≥n: formatearTiempo");
            try {
                // Crear una funci√≥n de prueba
                const formatearTiempo = (segundos) => {
                    const horas = Math.floor(segundos / 3600);
                    const minutos = Math.floor((segundos % 3600) / 60);
                    const secs = segundos % 60;
                    return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                };
                
                const result = formatearTiempo(14400); // 4 horas
                if (result === "04:00:00") {
                    updateTest(test, "pass", result);
                } else {
                    updateTest(test, "fail", `Expected 04:00:00, got ${result}`);
                }
            } catch (e) {
                updateTest(test, "fail", e.message);
            }

            // Test generarClave
            test = addTest("functionsTests", "Funci√≥n: generarClave");
            try {
                const clave = Math.random().toString(36).slice(-8).toUpperCase();
                if (clave.length === 8 && clave.match(/^[A-Z0-9]+$/)) {
                    updateTest(test, "pass", `Clave generada: ${clave}`);
                } else {
                    updateTest(test, "fail", "Formato de clave inv√°lido");
                }
            } catch (e) {
                updateTest(test, "fail", e.message);
            }

            // Test localStorage
            test = addTest("functionsTests", "localStorage disponible");
            try {
                localStorage.setItem("test", "value");
                if (localStorage.getItem("test") === "value") {
                    localStorage.removeItem("test");
                    updateTest(test, "pass");
                } else {
                    updateTest(test, "fail", "No se pueden leer/escribir datos");
                }
            } catch (e) {
                updateTest(test, "fail", e.message);
            }
        }

        async function testData() {
            const fileMap = {
                "Anestesiolog√≠a": "anestesiologia",
                "Cardiolog√≠a": "cardiologia",
                "Dermatolog√≠a": "dermatologia",
                "Diagn√≥stico por Im√°genes": "diagnostico_imagenes",
                "Hematolog√≠a": "hematologia",
                "Neumonolog√≠a": "neumonologia",
                "Neurolog√≠a": "neurologia",
                "Ortopedia": "ortopedia",
                "Otorrinolaringolog√≠a": "otorrinolaringologia",
                "Pediatr√≠a": "pediatria",
                "Psiquiatr√≠a": "psiquiatria",
                "Tocoginecolog√≠a": "tocoginecologia",
                "Urolog√≠a": "urologia"
            };

            for (const [nombre, archivo] of Object.entries(fileMap)) {
                const test = addTest("dataTests", `${nombre} (${archivo}.json)`);
                try {
                    const response = await fetch(`./data_final/${archivo}.json`);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    
                    const data = await response.json();
                    if (Array.isArray(data) && data.length === 100) {
                        updateTest(test, "pass", "100 preguntas cargadas");
                    } else {
                        updateTest(test, "fail", `${data.length} preguntas (se esperaban 100)`);
                    }
                } catch (e) {
                    updateTest(test, "fail", e.message);
                }
            }
        }

        async function runAllTests() {
            document.querySelectorAll(".test-item").forEach(t => t.remove());
            
            console.log("Iniciando pruebas...");
            await testFiles();
            console.log("‚úì Pruebas de archivos completadas");
            
            testFunctions();
            console.log("‚úì Pruebas de funciones completadas");
            
            await testData();
            console.log("‚úì Pruebas de datos completadas");
            
            updateResults();
        }

        // Ejecutar al cargar
        window.addEventListener("load", () => {
            const auto = new URLSearchParams(window.location.search).get("auto");
            if (auto === "true") {
                runAllTests();
            }
        });
    </script>
</body>
</html>
